{"ast":null,"code":"import _toConsumableArray from\"/Users/tony/Documents/Projects/react/Writer/writer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/tony/Documents/Projects/react/Writer/writer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tony/Documents/Projects/react/Writer/writer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/tony/Documents/Projects/react/Writer/writer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";//import { useState } from 'react';\nimport{useEffect,useRef,useState}from'react';import{toast}from'react-toastify';//import ApiRequest from 'src/Api/Data/requestApi';\nimport'./style.css';import{animateScroll}from'react-scroll';import ApiRequest from'src/Api/Requests/Apirequest';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ROOT_CSS={height:400};var ChatBox=function ChatBox(_ref){var open=_ref.open,SetOpen=_ref.SetOpen,socket=_ref.socket,email=_ref.email,loged=_ref.loged,taskid=_ref.taskid;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),Loged=_useState4[0],setLoged=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),receiver=_useState6[0],setReceiver=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),profile=_useState10[0],setProfile=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),clientProfile=_useState12[0],setClientProfile=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),senderUsername=_useState14[0],setUsername=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),Taskid=_useState16[0],setTaskId=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),writerUsername=_useState18[0],setWriterName=_useState18[1];var messagesEndRef=useRef(null);var scrollToBottom=function scrollToBottom(){animateScroll.scrollToBottom({containerId:\"MessageBox\"});};var loadChatClient=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var from,result,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://alert(taskid)\n//alert(Taskid)\nfrom=localStorage.getItem('mail');_context.next=3;return ApiRequest.loadChatUsers(from,email,taskid);case 3:result=_context.sent;data=result.data;// console.log(data)\nsetProfile(data.receiver[0].writer_profile);setClientProfile(data.sender[0].user_profile);//writer_display_namewriter_profile\nsetWriterName(data.receiver[0].writer_display_name);setUsername(data.receiver[0].writer_name);setMessages(data.messages);case 10:case\"end\":return _context.stop();}}},_callee);}));return function loadChatClient(){return _ref2.apply(this,arguments);};}();useEffect(function(){if(open==true){var from=localStorage.getItem('mail');setLoged(from);setReceiver(email);setTaskId(taskid);loadChatClient();socket.on('message',function(message){setMessages(function(messages){return[].concat(_toConsumableArray(messages),[message]);});setTimeout(function(){scrollToBottom();},100);});}},[]);var sendMessage=function sendMessage(){if(message===''){setMessage('');return;}var body={username:senderUsername,Imageurl:profile,message:message,receiver_id:receiver,sender_id:Loged,task_id:taskid};//\nsocket.emit('sendMessage',{message:body,room:receiver},function(){});//socket.emit('sendMessage',{body,receiver});\nsetMessages([].concat(_toConsumableArray(messages),[body]));setMessage('');setTimeout(function(){scrollToBottom();},100);};// alert(email)\nreturn/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup\",style:{display:open?\"block\":\"none\",backgroundColor:\"brown\"},id:\"myForm\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:\"5px\"},className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"avatar\",children:[/*#__PURE__*/_jsx(\"img\",{class:\"img-circle\",style:{width:\"40px\",height:\"40px\",borderRadius:\"20px\"},src:clientProfile}),\"\\xA0 \",/*#__PURE__*/_jsx(\"span\",{className:\"badge badge-warning\",children:writerUsername})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{float:'right',color:\"blue\",border:\"1px solid green\",backgroundColor:\"whitesmoke\"},className:\"btn badge-warning fa fa-times\",onClick:function onClick(){return SetOpen();}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{maxHeight:'500px',overflowY:'auto'},className:\"col-sm-12 col-sm-offset-4 frame\",children:[/*#__PURE__*/_jsx(\"ul\",{id:\"MessageBox\",ref:messagesEndRef,style:{maxHeight:'400px',overflowY:'auto'},children:messages.map(function(element){if(element.sender_id===Loged){return/*#__PURE__*/_jsx(\"li\",{style:{width:\"100%\"},children:/*#__PURE__*/_jsxs(\"div\",{class:\"msj-rta macro\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"text text-r\",children:[/*#__PURE__*/_jsx(\"p\",{children:element.message}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"small\",{})})]}),/*#__PURE__*/_jsx(\"div\",{class:\"avatar\",style:{padding:\"0px 0px 0px 10px !important\",width:'40px'},children:/*#__PURE__*/_jsx(\"img\",{class:\"img-circle\",style:{width:'40px',height:'40px',borderRadius:'20px'},src:profile})})]})});}if(element.receiver_id===receiver){return/*#__PURE__*/_jsx(\"li\",{style:{width:\"100%\"},children:/*#__PURE__*/_jsxs(\"div\",{class:\"msj macro\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"avatar\",children:/*#__PURE__*/_jsx(\"img\",{class:\"img-circle\",style:{width:'40px',height:'40px',borderRadius:'20px'},src:clientProfile})}),/*#__PURE__*/_jsxs(\"div\",{class:\"text text-l\",children:[/*#__PURE__*/_jsx(\"p\",{children:element.message}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"small\",{})})]})]})});}if(element.receiver_id===Loged){return/*#__PURE__*/_jsx(\"li\",{style:{width:\"100%\"},children:/*#__PURE__*/_jsxs(\"div\",{class:\"msj macro\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"avatar\",children:/*#__PURE__*/_jsx(\"img\",{class:\"img-circle\",style:{width:'40px',height:'40px',borderRadius:'20px'},src:clientProfile})}),/*#__PURE__*/_jsxs(\"div\",{class:\"text text-l\",children:[/*#__PURE__*/_jsx(\"p\",{children:element.message}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"small\",{})})]})]})});}if(element.sender_id===receiver){return/*#__PURE__*/_jsx(\"li\",{style:{width:\"100%\"},children:/*#__PURE__*/_jsxs(\"div\",{class:\"msj-rta macro\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"text text-r\",children:[/*#__PURE__*/_jsx(\"p\",{children:element.message}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"small\",{})})]}),/*#__PURE__*/_jsx(\"div\",{class:\"avatar\",style:{padding:\"0px 0px 0px 10px !important\"},children:/*#__PURE__*/_jsx(\"img\",{class:\"img-circle\",style:{width:'40px',height:'40px',borderRadius:'20px'},src:profile})})]})});}})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:\"5px\"},children:[/*#__PURE__*/_jsx(\"div\",{className:\"msj-rta macro\",children:/*#__PURE__*/_jsx(\"textarea\",{value:message,onKeyPress:function onKeyPress(event){return event.key==='Enter'?sendMessage():null;},onChange:function onChange(e){return setMessage(e.target.value);},style:{width:\"100%\",outline:\"none\"},className:\"mytext\",placeholder:\"Type a message\"})}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return sendMessage();},style:{padding:\"10px\",backgroundColor:\"#cff\",borderRadius:\"10px\",marginLeft:\"1px\",cursor:\"pointer\"},children:/*#__PURE__*/_jsx(\"span\",{className:\"fa fa-share\"})})]})]})]})});};export default ChatBox;","map":{"version":3,"sources":["/Users/tony/Documents/Projects/react/Writer/writer/src/views/ChatBox/ChatBox.js"],"names":["useEffect","useRef","useState","toast","animateScroll","ApiRequest","ROOT_CSS","height","ChatBox","open","SetOpen","socket","email","loged","taskid","messages","setMessages","Loged","setLoged","receiver","setReceiver","message","setMessage","profile","setProfile","clientProfile","setClientProfile","senderUsername","setUsername","Taskid","setTaskId","writerUsername","setWriterName","messagesEndRef","scrollToBottom","containerId","loadChatClient","from","localStorage","getItem","loadChatUsers","result","data","writer_profile","sender","user_profile","writer_display_name","writer_name","on","setTimeout","sendMessage","body","username","Imageurl","receiver_id","sender_id","task_id","emit","room","display","backgroundColor","marginBottom","width","borderRadius","float","color","border","maxHeight","overflowY","map","element","padding","event","key","e","target","value","outline","marginLeft","cursor"],"mappings":"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","sourcesContent":["//import { useState } from 'react';\nimport { useEffect, useRef, useState } from 'react';\nimport { toast } from 'react-toastify';\n//import ApiRequest from 'src/Api/Data/requestApi';\nimport './style.css';\nimport { animateScroll } from 'react-scroll';\nimport ApiRequest from 'src/Api/Requests/Apirequest';\nconst ROOT_CSS=({\n    height: 400,\n    \n  });\n\n\nconst ChatBox = ({open,SetOpen,socket,email,loged,taskid})=>{\n    \n    \n    const [messages,setMessages] = useState([]);\n    const [Loged,setLoged] = useState('');\n    const [receiver,setReceiver] = useState('');\n    const [message,setMessage] = useState('');\n    const [profile,setProfile] = useState('');\n    const [clientProfile,setClientProfile] = useState('');\n    const [senderUsername,setUsername] = useState('');\n    const [Taskid,setTaskId] = useState('');\n    const [writerUsername,setWriterName] =  useState('');\n    const messagesEndRef = useRef(null)\n    \n\n\n   const  scrollToBottom=() =>{\n       animateScroll.scrollToBottom({\n          containerId: \"MessageBox\"\n        });\n    \n    }\n\n    const loadChatClient =async  ()=>{\n        //alert(taskid)\n             //alert(Taskid)\n             var from = localStorage.getItem('mail');\n             \n             const result = await ApiRequest.loadChatUsers(from,email,taskid);\n\n             var data = result.data;\n\n           // console.log(data)\n             setProfile(data.receiver[0].writer_profile);\n            setClientProfile(data.sender[0].user_profile)\n             //writer_display_namewriter_profile\n             setWriterName(data.receiver[0].writer_display_name);\n             setUsername(data.receiver[0].writer_name)\n           \n             setMessages(data.messages);\n\n             \n\n    }\n\n   \n\n    useEffect(()=>{\n        if(open == true){\n            var from = localStorage.getItem('mail');\n            setLoged(from);\n            setReceiver(email);\n            setTaskId(taskid);\n            \n    \n            loadChatClient();\n\n            socket.on('message',(message)=>{\n                setMessages((messages)=>[...messages,message]);\n                setTimeout(() => {\n                  scrollToBottom();\n                }, 100);\n          });\n        }  \n        \n       \n        \n    },[])\n    \n\n\n    const sendMessage =()=>{\n      \n        if(message === ''){\n             setMessage('');\n            return;\n        }\n        var body ={\n            username:senderUsername,\n            Imageurl:profile,\n            message:message,\n            receiver_id:receiver,\n            sender_id:Loged,\n            task_id:taskid,\n        \n     }\n     //\n     socket.emit('sendMessage',{message:body,room:receiver}, () =>{\n    });\n\n     //socket.emit('sendMessage',{body,receiver});\n      setMessages([...messages,body])\n      setMessage('');\n      setTimeout(() => {\n        scrollToBottom();\n      }, 100);\n      \n\n    }\n   // alert(email)\n\n   return <>\n   \n    <div className=\"chat-popup\" style={{display:open?\"block\":\"none\",backgroundColor:\"brown\"}} id=\"myForm\">\n       \n        <div style={{marginBottom:\"5px\"}} className=\"container\">\n        <div class=\"avatar\">\n       \n            <img class=\"img-circle\" style={{width:\"40px\",height:\"40px\",borderRadius:\"20px\"}}  src={clientProfile} />\n           &nbsp; <span className=\"badge badge-warning\">{writerUsername}</span>\n            </div>\n    <button type=\"button\" style={{float:'right',color:\"blue\",\n                   border:\"1px solid green\",\n                   backgroundColor:\"whitesmoke\"\n\n          }} className=\"btn badge-warning fa fa-times\" onClick={()=>SetOpen()}></button>\n       </div>\n    <div style={{maxHeight:'500px',overflowY:'auto'}}  className=\"col-sm-12 col-sm-offset-4 frame\">\n    \n            <ul id=\"MessageBox\" ref={messagesEndRef} style={{maxHeight:'400px',overflowY:'auto'}}>\n           \n                 {\n\n                     messages.map((element)=>{\n                          \n                            if(element.sender_id === Loged){\n                                  return <li style={{width:\"100%\"}}>\n                                  <div class=\"msj-rta macro\">\n                                      <div class=\"text text-r\">\n                                          <p>\n                                         {element.message}\n                                          </p>\n                                          <p><small></small></p>\n                                      </div>\n                                  <div class=\"avatar\" style={{padding:\"0px 0px 0px 10px !important\",width:'40px'}}><img class=\"img-circle\" style={{width:'40px',height:'40px',borderRadius:'20px'}}  src={profile} /></div>                                \n                            </div>\n                            </li>  \n                            }\n                            if(element.receiver_id === receiver){\n                                 return  <li style={{width:\"100%\"}}>\n                                 <div class=\"msj macro\">\n                                 <div class=\"avatar\"><img class=\"img-circle\" style={{width:'40px',height:'40px',borderRadius:'20px'}}  src={clientProfile} /></div>\n                                     <div class=\"text text-l\">\n                                         <p>\n                                         {element.message}\n                                         </p>\n                                         <p><small></small></p>\n                                     </div>\n                                 </div>\n                             </li>\n                            }\n                            if(element.receiver_id === Loged){\n                                return  <li style={{width:\"100%\"}}>\n                                <div class=\"msj macro\">\n                                <div class=\"avatar\"><img class=\"img-circle\" style={{width:'40px',height:'40px',borderRadius:'20px'}}  src={clientProfile} /></div>\n                                    <div class=\"text text-l\">\n                                        <p>\n                                        {element.message}\n                                        </p>\n                                        <p><small></small></p>\n                                    </div>\n                                </div>\n                            </li>\n                           }\n                           if(element.sender_id === receiver){\n                            return <li style={{width:\"100%\"}}>\n                            <div class=\"msj-rta macro\">\n                                <div class=\"text text-r\">\n                                    <p>\n                                   {element.message}\n                                    </p>\n                                    <p><small></small></p>\n                                </div>\n                            <div class=\"avatar\" style={{padding:\"0px 0px 0px 10px !important\"}}><img class=\"img-circle\" style={{width:'40px',height:'40px',borderRadius:'20px'}}  src={profile} /></div>                                \n                      </div>\n                      </li>  \n                      }\n                    \n                     })\n\n\n                  \n                 }\n\n         \n\n\n                     \n            </ul>\n            \n            <div style={{marginBottom:\"5px\"}}>\n                <div className=\"msj-rta macro\">                        \n                    \n                        \n                        <textarea\n                        value={message}\n                        onKeyPress = {event => event.key === 'Enter' ? sendMessage() : null}\n                        onChange={(e)=>setMessage(e.target.value)} style={{width:\"100%\",outline:\"none\"}} className=\"mytext\" placeholder=\"Type a message\"/>\n                    \n\n                </div>\n                <div \n                   onClick={()=>sendMessage()}\n                style={{padding:\"10px\",backgroundColor:\"#cff\",\n                   borderRadius:\"10px\",\n                   marginLeft:\"1px\",\n                   cursor:\"pointer\"\n                 }}>\n                    <span className=\"fa fa-share\"></span>\n                </div>                \n            </div>\n            \n        </div>  \n       \n        \n        </div>\n    \n          </>\n}\n\nexport default ChatBox;"]},"metadata":{},"sourceType":"module"}