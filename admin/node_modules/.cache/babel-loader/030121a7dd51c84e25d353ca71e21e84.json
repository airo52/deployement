{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import axios from'axios';import'./Dropzone.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Dropzone=function Dropzone(){var fileInputRef=useRef();var modalImageRef=useRef();var modalRef=useRef();var progressRef=useRef();var uploadRef=useRef();var uploadModalRef=useRef();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),selectedFiles=_useState2[0],setSelectedFiles=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),validFiles=_useState4[0],setValidFiles=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),unsupportedFiles=_useState6[0],setUnsupportedFiles=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),errorMessage=_useState8[0],setErrorMessage=_useState8[1];useEffect(function(){var filteredArr=selectedFiles.reduce(function(acc,current){var x=acc.find(function(item){return item.name===current.name;});if(!x){return acc.concat([current]);}else{return acc;}},[]);setValidFiles(_toConsumableArray(filteredArr));},[selectedFiles]);var preventDefault=function preventDefault(e){e.preventDefault();// e.stopPropagation();\n};var dragOver=function dragOver(e){preventDefault(e);};var dragEnter=function dragEnter(e){preventDefault(e);};var dragLeave=function dragLeave(e){preventDefault(e);};var fileDrop=function fileDrop(e){preventDefault(e);var files=e.dataTransfer.files;if(files.length){handleFiles(files);}};var filesSelected=function filesSelected(){if(fileInputRef.current.files.length){handleFiles(fileInputRef.current.files);}};var fileInputClicked=function fileInputClicked(){fileInputRef.current.click();};var handleFiles=function handleFiles(files){var _loop=function _loop(i){if(validateFile(files[i])){setSelectedFiles(function(prevArray){return[].concat(_toConsumableArray(prevArray),[files[i]]);});}else{files[i]['invalid']=true;setSelectedFiles(function(prevArray){return[].concat(_toConsumableArray(prevArray),[files[i]]);});setErrorMessage('File type not permitted');setUnsupportedFiles(function(prevArray){return[].concat(_toConsumableArray(prevArray),[files[i]]);});}};for(var i=0;i<files.length;i++){_loop(i);}};var validateFile=function validateFile(file){var validTypes=['image/jpeg','image/jpg','image/png','image/gif','image/x-icon','application/pdf','application/doc','application/docx'];if(validTypes.indexOf(file.type)===-1){return false;}return true;};var fileSize=function fileSize(size){if(size===0){return'0 Bytes';}var k=1024;var sizes=['Bytes','KB','MB','GB','TB'];var i=Math.floor(Math.log(size)/Math.log(k));return parseFloat((size/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};var fileType=function fileType(fileName){return fileName.substring(fileName.lastIndexOf('.')+1,fileName.length)||fileName;};var removeFile=function removeFile(name){var index=validFiles.findIndex(function(e){return e.name===name;});var index2=selectedFiles.findIndex(function(e){return e.name===name;});var index3=unsupportedFiles.findIndex(function(e){return e.name===name;});validFiles.splice(index,1);selectedFiles.splice(index2,1);setValidFiles(_toConsumableArray(validFiles));setSelectedFiles(_toConsumableArray(selectedFiles));if(index3!==-1){unsupportedFiles.splice(index3,1);setUnsupportedFiles(_toConsumableArray(unsupportedFiles));}};var openImageModal=function openImageModal(file){var reader=new FileReader();modalRef.current.style.display=\"block\";reader.readAsDataURL(file);reader.onload=function(e){modalImageRef.current.style.backgroundImage=\"url(\".concat(e.target.result,\")\");};};var closeModal=function closeModal(){modalRef.current.style.display=\"none\";modalImageRef.current.style.backgroundImage='none';};var uploadFiles=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var i,formData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:uploadModalRef.current.style.display='block';uploadRef.current.innerHTML='File(s) Uploading...';for(i=0;i<validFiles.length;i++){formData=new FormData();formData.append('image',validFiles[i]);formData.append('key','');axios.post('https://api.imgbb.com/1/upload',formData,{onUploadProgress:function onUploadProgress(progressEvent){var uploadPercentage=Math.floor(progressEvent.loaded/progressEvent.total*100);progressRef.current.innerHTML=\"\".concat(uploadPercentage,\"%\");progressRef.current.style.width=\"\".concat(uploadPercentage,\"%\");if(uploadPercentage===100){uploadRef.current.innerHTML='File(s) Uploaded';validFiles.length=0;setValidFiles(_toConsumableArray(validFiles));setSelectedFiles(_toConsumableArray(validFiles));setUnsupportedFiles(_toConsumableArray(validFiles));}}}).catch(function(){uploadRef.current.innerHTML=\"<span class=\\\"error\\\">Error Uploading File(s)</span>\";progressRef.current.style.backgroundColor='red';});}case 3:case\"end\":return _context.stop();}}},_callee);}));return function uploadFiles(){return _ref.apply(this,arguments);};}();var closeUploadModal=function closeUploadModal(){uploadModalRef.current.style.display='none';};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"containers\",children:[unsupportedFiles.length?/*#__PURE__*/_jsx(\"p\",{children:\"Please remove all unsupported files.\"}):'',/*#__PURE__*/_jsxs(\"div\",{className:\"drop-container\",onDragOver:dragOver,onDragEnter:dragEnter,onDragLeave:dragLeave,onDrop:fileDrop,onClick:fileInputClicked,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"drop-message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"upload-icon\"}),\"Drag & Drop files here or click to select file(s)\"]}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,className:\"file-input\",type:\"file\",multiple:true,onChange:filesSelected})]}),/*#__PURE__*/_jsx(\"div\",{className:\"file-display-container\",children:validFiles.map(function(data,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"file-status-bar\",children:[/*#__PURE__*/_jsxs(\"div\",{onClick:!data.invalid?function(){return openImageModal(data);}:function(){return removeFile(data.name);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"file-type-logo\"}),/*#__PURE__*/_jsx(\"div\",{className:\"file-type\",children:fileType(data.name)}),/*#__PURE__*/_jsx(\"span\",{className:\"file-name \".concat(data.invalid?'file-error':''),children:data.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"file-size\",children:[\"(\",fileSize(data.size),\")\"]}),\" \",data.invalid&&/*#__PURE__*/_jsxs(\"span\",{className:\"file-error-message\",children:[\"(\",errorMessage,\")\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"file-remove\",onClick:function onClick(){return removeFile(data.name);},children:\"X\"})]},i);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",ref:modalRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"overlay\"}),/*#__PURE__*/_jsx(\"span\",{className:\"close\",onClick:function onClick(){return closeModal();},children:\"X\"}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-image\",ref:modalImageRef})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"none\"},className:\"upload-modal\",ref:uploadModalRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"overlay\"}),/*#__PURE__*/_jsx(\"div\",{className:\"close\",onClick:function onClick(){return closeUploadModal();},children:\"X\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-container\",children:[/*#__PURE__*/_jsx(\"span\",{ref:uploadRef}),/*#__PURE__*/_jsx(\"div\",{className:\"progress\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",ref:progressRef})})]})]})]});};export default Dropzone;","map":{"version":3,"sources":["/Users/tony/Documents/Projects/react/Writer/admin/src/views/base/Task/post/dropzone/Dropzone.js"],"names":["React","useRef","useState","useEffect","axios","Dropzone","fileInputRef","modalImageRef","modalRef","progressRef","uploadRef","uploadModalRef","selectedFiles","setSelectedFiles","validFiles","setValidFiles","unsupportedFiles","setUnsupportedFiles","errorMessage","setErrorMessage","filteredArr","reduce","acc","current","x","find","item","name","concat","preventDefault","e","dragOver","dragEnter","dragLeave","fileDrop","files","dataTransfer","length","handleFiles","filesSelected","fileInputClicked","click","i","validateFile","prevArray","file","validTypes","indexOf","type","fileSize","size","k","sizes","Math","floor","log","parseFloat","pow","toFixed","fileType","fileName","substring","lastIndexOf","removeFile","index","findIndex","index2","index3","splice","openImageModal","reader","FileReader","style","display","readAsDataURL","onload","backgroundImage","target","result","closeModal","uploadFiles","innerHTML","formData","FormData","append","post","onUploadProgress","progressEvent","uploadPercentage","loaded","total","width","catch","backgroundColor","closeUploadModal","map","data","invalid"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport axios from 'axios';\n\nimport './Dropzone.css';\n\nconst Dropzone = () => {\n    const fileInputRef = useRef();\n    const modalImageRef = useRef();\n    const modalRef = useRef();\n    const progressRef = useRef();\n    const uploadRef = useRef();\n    const uploadModalRef = useRef();\n    const [selectedFiles, setSelectedFiles] = useState([]);\n    const [validFiles, setValidFiles] = useState([]);\n    const [unsupportedFiles, setUnsupportedFiles] = useState([]);\n    const [errorMessage, setErrorMessage] = useState('');\n\n    useEffect(() => {\n        let filteredArr = selectedFiles.reduce((acc, current) => {\n            const x = acc.find(item => item.name === current.name);\n            if (!x) {\n              return acc.concat([current]);\n            } else {\n              return acc;\n            }\n        }, []);\n        setValidFiles([...filteredArr]);\n        \n    }, [selectedFiles]);\n\n    const preventDefault = (e) => {\n        e.preventDefault();\n        // e.stopPropagation();\n    }\n\n    const dragOver = (e) => {\n        preventDefault(e);\n    }\n\n    const dragEnter = (e) => {\n        preventDefault(e);\n    }\n\n    const dragLeave = (e) => {\n        preventDefault(e);\n    }\n\n    const fileDrop = (e) => {\n        preventDefault(e);\n        const files = e.dataTransfer.files;\n        if (files.length) {\n            handleFiles(files);\n        }\n    }\n\n    const filesSelected = () => {\n        if (fileInputRef.current.files.length) {\n            handleFiles(fileInputRef.current.files);\n        }\n    }\n\n    const fileInputClicked = () => {\n        fileInputRef.current.click();\n    }\n\n    const handleFiles = (files) => {\n        for(let i = 0; i < files.length; i++) {\n            if (validateFile(files[i])) {\n                setSelectedFiles(prevArray => [...prevArray, files[i]]);\n            } else {\n                files[i]['invalid'] = true;\n                setSelectedFiles(prevArray => [...prevArray, files[i]]);\n                setErrorMessage('File type not permitted');\n                setUnsupportedFiles(prevArray => [...prevArray, files[i]]);\n            }\n        }\n    }\n\n    const validateFile = (file) => {\n  \n        const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/x-icon','application/pdf','application/doc','application/docx'];\n        if (validTypes.indexOf(file.type) === -1) {\n            return false;\n        }\n\n        return true;\n    }\n\n    const fileSize = (size) => {\n        if (size === 0) {\n          return '0 Bytes';\n        }\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(size) / Math.log(k));\n        return parseFloat((size / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    }\n\n    const fileType = (fileName) => {\n        return fileName.substring(fileName.lastIndexOf('.') + 1, fileName.length) || fileName;\n    }\n\n    const removeFile = (name) => {\n        const index = validFiles.findIndex(e => e.name === name);\n        const index2 = selectedFiles.findIndex(e => e.name === name);\n        const index3 = unsupportedFiles.findIndex(e => e.name === name);\n        validFiles.splice(index, 1);\n        selectedFiles.splice(index2, 1);\n        setValidFiles([...validFiles]);\n        setSelectedFiles([...selectedFiles]);\n        if (index3 !== -1) {\n            unsupportedFiles.splice(index3, 1);\n            setUnsupportedFiles([...unsupportedFiles]);\n        }\n    }\n\n    const openImageModal = (file) => {\n        const reader = new FileReader();\n        modalRef.current.style.display = \"block\";\n        reader.readAsDataURL(file);\n        reader.onload = function(e) {\n            modalImageRef.current.style.backgroundImage = `url(${e.target.result})`;\n        }\n    }\n\n    const closeModal = () => {\n        modalRef.current.style.display = \"none\";\n        modalImageRef.current.style.backgroundImage = 'none';\n    }\n\n    const uploadFiles = async () => {\n        uploadModalRef.current.style.display = 'block';\n        uploadRef.current.innerHTML = 'File(s) Uploading...';\n        for (let i = 0; i < validFiles.length; i++) {\n            const formData = new FormData();\n            formData.append('image', validFiles[i]);\n            formData.append('key', '');\n\n            axios.post('https://api.imgbb.com/1/upload', formData, {\n                onUploadProgress: (progressEvent) => {\n                    const uploadPercentage = Math.floor((progressEvent.loaded / progressEvent.total) * 100);\n                    progressRef.current.innerHTML = `${uploadPercentage}%`;\n                    progressRef.current.style.width = `${uploadPercentage}%`;\n\n                    if (uploadPercentage === 100) {\n                        uploadRef.current.innerHTML = 'File(s) Uploaded';\n                        validFiles.length = 0;\n                        setValidFiles([...validFiles]);\n                        setSelectedFiles([...validFiles]);\n                        setUnsupportedFiles([...validFiles]);\n                    }\n                },\n            })\n            .catch(() => {\n                uploadRef.current.innerHTML = `<span class=\"error\">Error Uploading File(s)</span>`;\n                progressRef.current.style.backgroundColor = 'red';\n            })\n        }\n    }\n\n    const closeUploadModal = () => {\n        uploadModalRef.current.style.display = 'none';\n    }\n\n\n    return (\n        <>\n            <div className=\"containers\">\n              \n                {unsupportedFiles.length ? <p>Please remove all unsupported files.</p> : ''}\n                <div className=\"drop-container\"\n                    onDragOver={dragOver}\n                    onDragEnter={dragEnter}\n                    onDragLeave={dragLeave}\n                    onDrop={fileDrop}\n                    onClick={fileInputClicked}\n                >\n                    <div className=\"drop-message\">\n                        <div className=\"upload-icon\"></div>\n                        Drag & Drop files here or click to select file(s)\n                    </div>\n                    <input\n                        ref={fileInputRef}\n                        className=\"file-input\"\n                        type=\"file\"\n                        multiple\n                        onChange={filesSelected}\n                    />\n                </div>\n                <div className=\"file-display-container\">\n                    {\n                        validFiles.map((data, i) => \n                            <div className=\"file-status-bar\" key={i}>\n                                <div onClick={!data.invalid ? () => openImageModal(data) : () => removeFile(data.name)}>\n                                    <div className=\"file-type-logo\"></div>\n                                    <div className=\"file-type\">{fileType(data.name)}</div>\n                                    <span className={`file-name ${data.invalid ? 'file-error' : ''}`}>{data.name}</span>\n                                    <span className=\"file-size\">({fileSize(data.size)})</span> {data.invalid && <span className='file-error-message'>({errorMessage})</span>}\n                                </div>\n                                <div className=\"file-remove\" onClick={() => removeFile(data.name)}>X</div>\n                            </div>\n                        )\n                    }\n                </div>\n            </div>\n            <div className=\"modal\" ref={modalRef}>\n                <div className=\"overlay\"></div>\n                <span className=\"close\" onClick={(() => closeModal())}>X</span>\n                <div className=\"modal-image\" ref={modalImageRef}></div>\n            </div>\n\n            <div style={{display:\"none\"}} className=\"upload-modal\" ref={uploadModalRef}>\n                <div className=\"overlay\"></div>\n                <div className=\"close\" onClick={(() => closeUploadModal())}>X</div>\n                <div className=\"progress-container\">\n                    <span ref={uploadRef}></span>\n                    <div className=\"progress\">\n                        <div className=\"progress-bar\" ref={progressRef}></div>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n}\n\nexport default Dropzone;\n"]},"metadata":{},"sourceType":"module"}