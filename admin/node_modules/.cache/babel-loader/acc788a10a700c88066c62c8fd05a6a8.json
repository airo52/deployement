{"ast":null,"code":"import _toConsumableArray from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{CBadge,CDropdown,CDropdownItem,CDropdownMenu,CDropdownToggle,CImg}from'@coreui/react';import CIcon from'@coreui/icons-react';import ChatBox from'src/views/ChatBox/ChatBox';import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TheHeaderDropdownMssg=function TheHeaderDropdownMssg(_ref){var socket=_ref.socket,state=_ref.state;var notify=function notify(data){return toast(data);};var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setOpen=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),email=_useState4[0],setEmail=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),taskid=_useState6[0],setTaskid=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),newMessage=_useState8[0],setNewMessage=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),itemsCount=_useState10[0],setItemCount=_useState10[1];var Open=function Open(mail,taskid){setTaskid(taskid);setEmail(mail);setOpen(!open);var lists=newMessage.filter(function(x){return x.task_id!=taskid;});// console.log(lists)\nsetNewMessage(lists);setTimeout(function(){// Count()\nvar legth=lists.length;setItemCount(legth);},1200);};var Alert=function Alert(message){return setTimeout(function(){notify('you have a new message from '+message.username+\"...\"+message.message.substring(0,100));},3000);};var Count=function Count(){var legth=newMessage.length;setItemCount(legth+1);};if(state){socket.on('newMessage',function(message){//console.log(message);\n//clearTimeout(Alert);\n//Alert(message)\nvar found=newMessage.some(function(item){return item.task_id===message.task_id;});if(!found){setNewMessage(function(newMessage){return[].concat(_toConsumableArray(newMessage),[message]);});}setTimeout(function(){Count();},1200);},[]);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(CDropdown,{inNav:true,className:\"c-header-nav-item mx-2\",direction:\"down\",children:[/*#__PURE__*/_jsxs(CDropdownToggle,{className:\"c-header-nav-link\",caret:false,children:[/*#__PURE__*/_jsx(CIcon,{name:\"cil-envelope-open\"}),/*#__PURE__*/_jsx(CBadge,{shape:\"pill\",color:\"info\",children:itemsCount})]}),/*#__PURE__*/_jsxs(CDropdownMenu,{className:\"pt-0\",placement:\"bottom-end\",children:[/*#__PURE__*/_jsx(CDropdownItem,{header:true,tag:\"div\",color:\"light\",children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"You have \",itemsCount,\" messages\"]})}),newMessage.map(function(item){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(CDropdownItem,{onClick:function onClick(){return Open(item.sender_id,item.task_id);},href:\"#\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pt-3 mr-3 float-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"c-avatar\",children:[/*#__PURE__*/_jsx(CImg,{style:{width:\"40px\",height:\"40px\",borderRadius:\"20px\"},src:item.Imageurl,className:\"c-avatar-img\",alt:\"admin@bootstrapmaster.com\"}),/*#__PURE__*/_jsx(\"span\",{className:\"c-avatar-status bg-warning\"})]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:item.username}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted float-right mt-1\",children:\"5 minutes ago\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-truncate font-weight-bold\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"small text-muted text-truncate\",children:/*#__PURE__*/_jsx(\"p\",{children:item.message})}),/*#__PURE__*/_jsx(\"br\",{})]})})});})]})]}),open&&/*#__PURE__*/_jsx(ChatBox,{open:open,SetOpen:Open,email:email,socket:socket,taskid:taskid}),/*#__PURE__*/_jsx(ToastContainer,{})]});};export default TheHeaderDropdownMssg;","map":{"version":3,"sources":["/Users/tony/Documents/Projects/react/Writer/admin/src/containers/TheHeaderDropdownMssg.js"],"names":["React","useEffect","useState","CBadge","CDropdown","CDropdownItem","CDropdownMenu","CDropdownToggle","CImg","CIcon","ChatBox","ToastContainer","toast","TheHeaderDropdownMssg","socket","state","notify","data","open","setOpen","email","setEmail","taskid","setTaskid","newMessage","setNewMessage","itemsCount","setItemCount","Open","mail","lists","filter","x","task_id","setTimeout","legth","length","Alert","message","username","substring","Count","on","found","some","item","map","sender_id","width","height","borderRadius","Imageurl"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport {\n  CBadge,\n  CDropdown,\n  CDropdownItem,\n  CDropdownMenu,\n  CDropdownToggle,\n  CImg\n} from '@coreui/react'\nimport CIcon from '@coreui/icons-react'\nimport ChatBox from 'src/views/ChatBox/ChatBox';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\nconst TheHeaderDropdownMssg = ({socket,state}) => {\n  const notify = (data) => toast(data);\n  \n  const [open,setOpen]=useState(false);\n  const [email,setEmail] = useState('');\n  const [taskid,setTaskid] =useState('');\n\n  const [newMessage,setNewMessage] = useState([]);\n  const [itemsCount,setItemCount] = useState(0);\n  const Open=(mail,taskid)=>{\n    setTaskid(taskid);\n    setEmail(mail);\n    setOpen(!open);\n\n    var lists = newMessage.filter(x => {\n      return x.task_id != taskid;\n    })\n\n   // console.log(lists)\n    setNewMessage(lists);\n\n    setTimeout(() => {\n     // Count()\n     var legth = lists.length;\n\n     setItemCount(legth);\n   }, 1200);\n   }\n   \nconst Alert = (message)=>setTimeout(() => {\n  notify('you have a new message from '+message.username+\"...\"+message.message.substring(0, 100));\n\n  \n}, 3000);\n\nconst Count = ()=>{\n    var legth = newMessage.length;\n\n  setItemCount(legth +1);\n}\n\n   if(state){\n    socket.on('newMessage',(message)=>{\n      //console.log(message);\n          //clearTimeout(Alert);\n          //Alert(message)\n\n          const found = newMessage.some(item=>item.task_id === message.task_id);\n          if(!found){\n            setNewMessage((newMessage)=>[...newMessage,message]);\n          }\n          setTimeout(() => {\n             Count()\n          }, 1200);\n\n         \n      \n    },[]);\n   }\n  \n   \n  \n  return (<>\n    <CDropdown\n      inNav\n      className=\"c-header-nav-item mx-2\"\n      direction=\"down\"\n    >\n      <CDropdownToggle className=\"c-header-nav-link\" caret={false}>\n        <CIcon name=\"cil-envelope-open\" /><CBadge shape=\"pill\" color=\"info\">{itemsCount}</CBadge>\n      </CDropdownToggle>\n      <CDropdownMenu className=\"pt-0\" placement=\"bottom-end\">\n        <CDropdownItem\n          header\n          tag=\"div\"\n          color=\"light\"\n        >\n          <strong>You have {itemsCount} messages</strong>\n        </CDropdownItem>\n       \n       {newMessage.map((item)=>{\n         return <>\n                   <CDropdownItem onClick={()=>Open(item.sender_id,item.task_id)} href=\"#\">\n          <div className=\"message\">\n            <div className=\"pt-3 mr-3 float-left\">\n              <div className=\"c-avatar\">\n                <CImg\n                 style={{width:\"40px\",height:\"40px\",borderRadius:\"20px\"}}\n                  src={item.Imageurl}\n                  className=\"c-avatar-img\"\n                  alt=\"admin@bootstrapmaster.com\"\n                />\n                <span className=\"c-avatar-status bg-warning\"></span>\n              </div>\n            </div>\n            <div>\n              <small className=\"text-muted\">{item.username}</small>\n              <small className=\"text-muted float-right mt-1\">5 minutes ago</small>\n            </div>\n            <div className=\"text-truncate font-weight-bold\"></div>\n            <br/>\n            <div className=\"small text-muted text-truncate\">\n              <p>{item.message}</p>\n            </div>\n            <br/>\n          </div>\n        </CDropdownItem>\n                </>\n       })}\n\n        \n      </CDropdownMenu>\n    </CDropdown>\n    {open && <ChatBox\n    open={open}\n    SetOpen={Open}\n    email={email}\n    socket={socket}\n    taskid={taskid}\n   />}\n   <ToastContainer />\n   </>\n  )\n}\n\nexport default TheHeaderDropdownMssg"]},"metadata":{},"sourceType":"module"}