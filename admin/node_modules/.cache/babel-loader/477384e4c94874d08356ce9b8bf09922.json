{"ast":null,"code":"import _regeneratorRuntime from \"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/tony/Documents/Projects/react/Writer/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n/**\n * This component represents the entire panel which gets dropped down when the\n * user selects the component.  It encapsulates the search filter, the\n * Select-all item, and the list of options.\n */\n\n\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useKey } from \"../hooks/use-key\";\nimport { useMultiSelect } from \"../hooks/use-multi-select\";\nimport { KEY } from \"../lib/constants\";\nimport { debounce } from \"../lib/debounce\";\nimport { filterOptions } from \"../lib/fuzzy-match-utils\";\nimport { Cross } from \"./cross\";\nimport SelectItem from \"./select-item\";\nimport SelectList from \"./select-list\";\nvar FocusType;\n\n(function (FocusType) {\n  FocusType[FocusType[\"SEARCH\"] = 0] = \"SEARCH\";\n  FocusType[FocusType[\"NONE\"] = -1] = \"NONE\";\n})(FocusType || (FocusType = {}));\n\nvar SelectPanel = function SelectPanel() {\n  var _useMultiSelect = useMultiSelect(),\n      t = _useMultiSelect.t,\n      onChange = _useMultiSelect.onChange,\n      options = _useMultiSelect.options,\n      setOptions = _useMultiSelect.setOptions,\n      value = _useMultiSelect.value,\n      customFilterOptions = _useMultiSelect.filterOptions,\n      ItemRenderer = _useMultiSelect.ItemRenderer,\n      disabled = _useMultiSelect.disabled,\n      disableSearch = _useMultiSelect.disableSearch,\n      hasSelectAll = _useMultiSelect.hasSelectAll,\n      ClearIcon = _useMultiSelect.ClearIcon,\n      debounceDuration = _useMultiSelect.debounceDuration,\n      isCreatable = _useMultiSelect.isCreatable,\n      onCreateOption = _useMultiSelect.onCreateOption;\n\n  var listRef = useRef();\n  var searchInputRef = useRef();\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      searchText = _useState2[0],\n      setSearchText = _useState2[1];\n\n  var _useState3 = useState(options),\n      _useState4 = _slicedToArray(_useState3, 2),\n      filteredOptions = _useState4[0],\n      setFilteredOptions = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      searchTextForFilter = _useState6[0],\n      setSearchTextForFilter = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      focusIndex = _useState8[0],\n      setFocusIndex = _useState8[1];\n\n  var debouncedSearch = useCallback(debounce(function (query) {\n    return setSearchTextForFilter(query);\n  }, debounceDuration), []);\n  var skipIndex = useMemo(function () {\n    var start = 0;\n    if (!disableSearch) start += 1; // if search is enabled then +1 to skipIndex\n\n    if (hasSelectAll) start += 1; // if select-all is enabled then +1 to skipIndex\n\n    return start;\n  }, [disableSearch, hasSelectAll]);\n  var selectAllOption = {\n    label: searchText ? t(\"selectAllFiltered\") : t(\"selectAll\"),\n    value: \"\"\n  };\n\n  var selectAllValues = function selectAllValues(checked) {\n    var filteredValues = filteredOptions.filter(function (o) {\n      return !o.disabled;\n    }).map(function (o) {\n      return o.value;\n    });\n\n    if (checked) {\n      var selectedValues = value.map(function (o) {\n        return o.value;\n      });\n      var finalSelectedValues = [].concat(_toConsumableArray(selectedValues), _toConsumableArray(filteredValues));\n      return options.filter(function (o) {\n        return finalSelectedValues.includes(o.value);\n      });\n    }\n\n    return value.filter(function (o) {\n      return !filteredValues.includes(o.value);\n    });\n  };\n\n  var selectAllChanged = function selectAllChanged(checked) {\n    var newOptions = selectAllValues(checked);\n    onChange(newOptions);\n  };\n\n  var handleSearchChange = function handleSearchChange(e) {\n    debouncedSearch(e.target.value);\n    setSearchText(e.target.value);\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  var handleClear = function handleClear() {\n    var _searchInputRef$curre;\n\n    setSearchTextForFilter(\"\");\n    setSearchText(\"\");\n    searchInputRef == null ? void 0 : (_searchInputRef$curre = searchInputRef.current) == null ? void 0 : _searchInputRef$curre.focus();\n  };\n\n  var handleItemClicked = function handleItemClicked(index) {\n    return setFocusIndex(index);\n  }; // Arrow Key Navigation\n\n\n  var handleKeyDown = function handleKeyDown(e) {\n    switch (e.code) {\n      case KEY.ARROW_UP:\n        updateFocus(-1);\n        break;\n\n      case KEY.ARROW_DOWN:\n        updateFocus(1);\n        break;\n\n      default:\n        return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  useKey([KEY.ARROW_DOWN, KEY.ARROW_UP], handleKeyDown, {\n    target: listRef\n  });\n\n  var handleSearchFocus = function handleSearchFocus() {\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  var handleOnCreateOption = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var newOption;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              newOption = {\n                label: searchText,\n                value: searchText,\n                __isNew__: true\n              }; // if custom `onCreateOption` is given then this will call this\n\n              if (!onCreateOption) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 4;\n              return onCreateOption(searchText);\n\n            case 4:\n              newOption = _context.sent;\n\n            case 5:\n              // adds created value to existing options\n              setOptions([newOption].concat(_toConsumableArray(options)));\n              handleClear();\n              onChange([].concat(_toConsumableArray(value), [newOption]));\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleOnCreateOption() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getFilteredOptions = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!customFilterOptions) {\n                _context2.next = 6;\n                break;\n              }\n\n              _context2.next = 3;\n              return customFilterOptions(options, searchTextForFilter);\n\n            case 3:\n              _context2.t0 = _context2.sent;\n              _context2.next = 7;\n              break;\n\n            case 6:\n              _context2.t0 = filterOptions(options, searchTextForFilter);\n\n            case 7:\n              return _context2.abrupt(\"return\", _context2.t0);\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getFilteredOptions() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var updateFocus = function updateFocus(offset) {\n    var newFocus = focusIndex + offset;\n    newFocus = Math.max(0, newFocus);\n    newFocus = Math.min(newFocus, options.length + Math.max(skipIndex - 1, 0));\n    setFocusIndex(newFocus);\n  };\n\n  useEffect(function () {\n    var _listRef$current, _listRef$current$quer;\n\n    listRef == null ? void 0 : (_listRef$current = listRef.current) == null ? void 0 : (_listRef$current$quer = _listRef$current.querySelector(\"[tabIndex='\" + focusIndex + \"']\")) == null ? void 0 : _listRef$current$quer.focus();\n  }, [focusIndex]);\n\n  var _useMemo = useMemo(function () {\n    var filteredOptionsList = filteredOptions.filter(function (o) {\n      return !o.disabled;\n    });\n    return [filteredOptionsList.every(function (o) {\n      return value.findIndex(function (v) {\n        return v.value === o.value;\n      }) !== -1;\n    }), filteredOptionsList.length !== 0]; // eslint-disable-next-line\n  }, [filteredOptions, value]),\n      _useMemo2 = _slicedToArray(_useMemo, 2),\n      isAllOptionSelected = _useMemo2[0],\n      hasSelectableOptions = _useMemo2[1];\n\n  useEffect(function () {\n    getFilteredOptions().then(setFilteredOptions);\n  }, [searchTextForFilter, options]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"select-panel\",\n    role: \"listbox\",\n    ref: listRef\n  }, !disableSearch && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"search\"\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    placeholder: t(\"search\"),\n    type: \"text\",\n    \"aria-describedby\": t(\"search\"),\n    onChange: handleSearchChange,\n    onFocus: handleSearchFocus,\n    value: searchText,\n    ref: searchInputRef,\n    tabIndex: 0\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    className: \"search-clear-button\",\n    hidden: !searchText,\n    onClick: handleClear,\n    \"aria-label\": t(\"clearSearch\")\n  }, ClearIcon || /*#__PURE__*/React.createElement(Cross, null))), /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"options\"\n  }, hasSelectAll && hasSelectableOptions && /*#__PURE__*/React.createElement(SelectItem, {\n    tabIndex: skipIndex === 1 ? 0 : 1,\n    checked: isAllOptionSelected,\n    option: selectAllOption,\n    onSelectionChanged: selectAllChanged,\n    onClick: function onClick() {\n      return handleItemClicked(1);\n    },\n    itemRenderer: ItemRenderer,\n    disabled: disabled\n  }), filteredOptions.length ? /*#__PURE__*/React.createElement(SelectList, {\n    skipIndex: skipIndex,\n    options: filteredOptions,\n    onClick: function onClick(_e, index) {\n      return handleItemClicked(index);\n    }\n  }) : isCreatable ? /*#__PURE__*/React.createElement(\"li\", {\n    onClick: handleOnCreateOption,\n    className: \"select-item creatable\"\n  }, t(\"create\") + \" \\\"\" + searchText + \"\\\"\") : /*#__PURE__*/React.createElement(\"li\", {\n    className: \"no-options\"\n  }, t(\"noOptions\"))));\n};\n\nexport default SelectPanel;","map":{"version":3,"sources":["../../../src/select-panel/index.tsx"],"names":["FocusType","SelectPanel","filterOptions","onCreateOption","useMultiSelect","listRef","useRef","searchInputRef","useState","debouncedSearch","useCallback","debounce","query","setSearchTextForFilter","skipIndex","useMemo","start","selectAllOption","label","searchText","t","value","selectAllValues","checked","filteredValues","filteredOptions","o","selectedValues","finalSelectedValues","options","selectAllChanged","newOptions","onChange","handleSearchChange","e","setSearchText","setFocusIndex","handleClear","handleItemClicked","index","handleKeyDown","KEY","updateFocus","useKey","target","handleSearchFocus","handleOnCreateOption","newOption","__isNew__","setOptions","getFilteredOptions","customFilterOptions","offset","newFocus","focusIndex","Math","useEffect","filteredOptionsList","v","ClearIcon","hasSelectAll","disabled","isCreatable"],"mappings":"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","sourcesContent":["/**\n * This component represents the entire panel which gets dropped down when the\n * user selects the component.  It encapsulates the search filter, the\n * Select-all item, and the list of options.\n */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { useKey } from \"../hooks/use-key\";\nimport { useMultiSelect } from \"../hooks/use-multi-select\";\nimport { KEY } from \"../lib/constants\";\nimport { debounce } from \"../lib/debounce\";\nimport { filterOptions } from \"../lib/fuzzy-match-utils\";\nimport { Cross } from \"./cross\";\nimport SelectItem from \"./select-item\";\nimport SelectList from \"./select-list\";\n\nenum FocusType {\n  SEARCH = 0,\n  NONE = -1,\n}\n\nconst SelectPanel = () => {\n  const {\n    t,\n    onChange,\n    options,\n    setOptions,\n    value,\n    filterOptions: customFilterOptions,\n    ItemRenderer,\n    disabled,\n    disableSearch,\n    hasSelectAll,\n    ClearIcon,\n    debounceDuration,\n    isCreatable,\n    onCreateOption,\n  } = useMultiSelect();\n\n  const listRef = useRef<any>();\n  const searchInputRef = useRef<any>();\n  const [searchText, setSearchText] = useState(\"\");\n  const [filteredOptions, setFilteredOptions] = useState(options);\n  const [searchTextForFilter, setSearchTextForFilter] = useState(\"\");\n  const [focusIndex, setFocusIndex] = useState(0);\n  const debouncedSearch = useCallback(\n    debounce((query) => setSearchTextForFilter(query), debounceDuration),\n    []\n  );\n\n  const skipIndex = useMemo(() => {\n    let start = 0;\n\n    if (!disableSearch) start += 1; // if search is enabled then +1 to skipIndex\n    if (hasSelectAll) start += 1; // if select-all is enabled then +1 to skipIndex\n\n    return start;\n  }, [disableSearch, hasSelectAll]);\n\n  const selectAllOption = {\n    label: searchText ? t(\"selectAllFiltered\") : t(\"selectAll\"),\n    value: \"\",\n  };\n\n  const selectAllValues = (checked) => {\n    const filteredValues = filteredOptions\n      .filter((o) => !o.disabled)\n      .map((o) => o.value);\n\n    if (checked) {\n      const selectedValues = value.map((o) => o.value);\n      const finalSelectedValues = [...selectedValues, ...filteredValues];\n\n      return options.filter((o) => finalSelectedValues.includes(o.value));\n    }\n\n    return value.filter((o) => !filteredValues.includes(o.value));\n  };\n\n  const selectAllChanged = (checked: boolean) => {\n    const newOptions = selectAllValues(checked);\n    onChange(newOptions);\n  };\n\n  const handleSearchChange = (e) => {\n    debouncedSearch(e.target.value);\n    setSearchText(e.target.value);\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleClear = () => {\n    setSearchTextForFilter(\"\");\n    setSearchText(\"\");\n    searchInputRef?.current?.focus();\n  };\n\n  const handleItemClicked = (index: number) => setFocusIndex(index);\n\n  // Arrow Key Navigation\n  const handleKeyDown = (e) => {\n    switch (e.code) {\n      case KEY.ARROW_UP:\n        updateFocus(-1);\n        break;\n      case KEY.ARROW_DOWN:\n        updateFocus(1);\n        break;\n      default:\n        return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  useKey([KEY.ARROW_DOWN, KEY.ARROW_UP], handleKeyDown, {\n    target: listRef,\n  });\n\n  const handleSearchFocus = () => {\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleOnCreateOption = async () => {\n    let newOption = { label: searchText, value: searchText, __isNew__: true };\n\n    // if custom `onCreateOption` is given then this will call this\n    if (onCreateOption) {\n      newOption = await onCreateOption(searchText);\n    }\n\n    // adds created value to existing options\n    setOptions([newOption, ...options]);\n    handleClear();\n\n    onChange([...value, newOption]);\n  };\n\n  const getFilteredOptions = async () =>\n    customFilterOptions\n      ? await customFilterOptions(options, searchTextForFilter)\n      : filterOptions(options, searchTextForFilter);\n\n  const updateFocus = (offset: number) => {\n    let newFocus = focusIndex + offset;\n    newFocus = Math.max(0, newFocus);\n    newFocus = Math.min(newFocus, options.length + Math.max(skipIndex - 1, 0));\n    setFocusIndex(newFocus);\n  };\n\n  useEffect(() => {\n    listRef?.current?.querySelector(`[tabIndex='${focusIndex}']`)?.focus();\n  }, [focusIndex]);\n\n  const [isAllOptionSelected, hasSelectableOptions] = useMemo(() => {\n    const filteredOptionsList = filteredOptions.filter((o) => !o.disabled);\n    return [\n      filteredOptionsList.every(\n        (o) => value.findIndex((v) => v.value === o.value) !== -1\n      ),\n      filteredOptionsList.length !== 0,\n    ];\n    // eslint-disable-next-line\n  }, [filteredOptions, value]);\n\n  useEffect(() => {\n    getFilteredOptions().then(setFilteredOptions);\n  }, [searchTextForFilter, options]);\n\n  return (\n    <div className=\"select-panel\" role=\"listbox\" ref={listRef}>\n      {!disableSearch && (\n        <div className=\"search\">\n          <input\n            placeholder={t(\"search\")}\n            type=\"text\"\n            aria-describedby={t(\"search\")}\n            onChange={handleSearchChange}\n            onFocus={handleSearchFocus}\n            value={searchText}\n            ref={searchInputRef}\n            tabIndex={0}\n          />\n          <button\n            type=\"button\"\n            className=\"search-clear-button\"\n            hidden={!searchText}\n            onClick={handleClear}\n            aria-label={t(\"clearSearch\")}\n          >\n            {ClearIcon || <Cross />}\n          </button>\n        </div>\n      )}\n\n      <ul className=\"options\">\n        {hasSelectAll && hasSelectableOptions && (\n          <SelectItem\n            tabIndex={skipIndex === 1 ? 0 : 1}\n            checked={isAllOptionSelected}\n            option={selectAllOption}\n            onSelectionChanged={selectAllChanged}\n            onClick={() => handleItemClicked(1)}\n            itemRenderer={ItemRenderer}\n            disabled={disabled}\n          />\n        )}\n\n        {filteredOptions.length ? (\n          <SelectList\n            skipIndex={skipIndex}\n            options={filteredOptions}\n            onClick={(_e, index) => handleItemClicked(index)}\n          />\n        ) : isCreatable ? (\n          <li onClick={handleOnCreateOption} className=\"select-item creatable\">\n            {`${t(\"create\")} \"${searchText}\"`}\n          </li>\n        ) : (\n          <li className=\"no-options\">{t(\"noOptions\")}</li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default SelectPanel;\n"]},"metadata":{},"sourceType":"module"}